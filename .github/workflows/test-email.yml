name: Test Email (smtplib)

on:
  workflow_dispatch:

jobs:
  send-test-email:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Send Test Email via smtplib
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
        run: |
          python - <<'PY'
          import os, smtplib
          from email.mime.text import MIMEText
          from email.mime.multipart import MIMEMultipart

          sender = os.getenv("EMAIL_USER")
          password = os.getenv("EMAIL_PASSWORD")
          receiver = os.getenv("EMAIL_TO")

          msg = MIMEMultipart()
          msg["From"] = sender
          msg["To"] = receiver
          msg["Subject"] = "Test desde GitHub Actions"
          msg.attach(MIMEText("¡Este es un correo de prueba enviado automáticamente por GitHub Actions!", "plain"))

          server = smtplib.SMTP("smtp.gmail.com", 587)
          server.starttls()
          server.login(sender, password)
          server.sendmail(sender, receiver, msg.as_string())
          server.quit()
          print("Correo enviado correctamente")
          PY
